ggarrange(a,b,c, nrow=1)
bind(Fac[[1]], processedShao$mode1) %>% as_tibble()
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble()
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% ggplot(aes(x=as.factor(Delivery_mode),y=`1`)) + geom_boxplot9)
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% ggplot(aes(x=as.factor(Delivery_mode),y=`1`)) + geom_boxplot()
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% ggplot(aes(x=as.factor(Delivery_mode),y=`2`)) + geom_boxplot()
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% ggplot(aes(x=as.factor(Delivery_mode),y=`3`)) + geom_boxplot()
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% filter(Delivery_mode=="Vaginal") %>% select(`1`) %>% pull() %>% mean
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% filter(Delivery_mode=="Caesarean") %>% select(`1`) %>% pull() %>% mean
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% filter(Delivery_mode=="Caesarean") %>% select(`2`) %>% pull() %>% mean
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% filter(Delivery_mode=="Vaginal") %>% select(`2`) %>% pull() %>% mean
# Plot 3B - make by hand to deal with colour feedback
# Set up colours
colours = RColorBrewer:: brewer.pal(8, "Dark2")
bm_cols = colours[1:2]
phylum_cols = colours[-c(1:2)]
# Flip Fac where needed
Fac = finalModel$Fac
Fac[[2]][,1] = -1 * Fac[[2]][,1]
Fac[[3]][,1] = -1 * Fac[[3]][,1]
Fac[[2]][,3] = -1 * Fac[[2]][,3]
Fac[[3]][,3] = -1 * Fac[[3]][,3]
# Flip subject modes to fix feature loading plots later on
Fac[[1]][,2] = -1 * Fac[[1]][,2]
Fac[[2]][,2] = -1 * Fac[[2]][,2]
Fac[[1]][,3] = -1 * Fac[[1]][,3]
Fac[[2]][,3] = -1 * Fac[[2]][,3]
days = c("4", "7", "21", "Infancy")
a = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 1") + theme(legend.position="none",text=element_text(size=12))
b = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
c = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V1)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
d = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 2") + theme(legend.position="none",text=element_text(size=12))
e = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
f = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V2)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
g = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("Subject index") + ylab("Component 3") + theme(legend.position="none",text=element_text(size=12))
h = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("Feature index") + ylab("") + theme(legend.position="none", text=element_text(size=12))
i = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V3)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="Time point [days]",limits=days)
ggarrange(a,b,c,d,e,f,g,h,i)
ggarrange(a,b,c,d,e,f,g,h,i)
# Plot 3B - make by hand to deal with colour feedback
# Set up colours
colours = RColorBrewer:: brewer.pal(8, "Dark2")
bm_cols = colours[1:2]
phylum_cols = colours[-c(1:2)]
# Flip Fac where needed
Fac = finalModel$Fac
days = c("4", "7", "21", "Infancy")
a = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 1") + theme(legend.position="none",text=element_text(size=12))
b = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
c = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V1)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
d = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 2") + theme(legend.position="none",text=element_text(size=12))
e = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
f = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V2)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
g = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("Subject index") + ylab("Component 3") + theme(legend.position="none",text=element_text(size=12))
h = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("Feature index") + ylab("") + theme(legend.position="none", text=element_text(size=12))
i = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V3)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="Time point [days]",limits=days)
ggarrange(a,b,c,d,e,f,g,h,i)
ggarrange(a,b,c,d,e,f,g,h,i)
# Plot 3B - make by hand to deal with colour feedback
# Set up colours
colours = RColorBrewer:: brewer.pal(8, "Dark2")
bm_cols = colours[1:2]
phylum_cols = colours[-c(1:2)]
# Flip Fac where needed
Fac = finalModel$Fac
Fac[[3]][,2] = -1 * Fac[[3]][,2]
Fac[[1]][,2] = -1 * Fac[[1]][,2]
Fac[[3]][,3] = -1 * Fac[[3]][,3]
Fac[[1]][,3] = -1 * Fac[[1]][,3]
days = c("4", "7", "21", "Infancy")
a = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 1") + theme(legend.position="none",text=element_text(size=12))
b = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
c = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V1)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
d = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 2") + theme(legend.position="none",text=element_text(size=12))
e = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
f = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V2)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
g = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("Subject index") + ylab("Component 3") + theme(legend.position="none",text=element_text(size=12))
h = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("Feature index") + ylab("") + theme(legend.position="none", text=element_text(size=12))
i = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V3)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="Time point [days]",limits=days)
ggarrange(a,b,c,d,e,f,g,h,i)
ggarrange(a,b,c,d,e,f,g,h,i)
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble()
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% filter(Delivery_mode=="Vaginal") %>% select(`1`) %>% pull() %>% mean
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% filter(Delivery_mode=="Caesarean") %>% select(`1`) %>% pull() %>% mean
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% filter(Delivery_mode=="Vaginal") %>% select(`2`) %>% pull() %>% mean
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% filter(Delivery_mode=="Caesarean") %>% select(`2`) %>% pull() %>% mean
temp1 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`1`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`1`) > 0.01)
name = str_split_fixed(temp1$mOTU, "\\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
a = temp1 %>% ggplot(aes(x=`1`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 1") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
temp2 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`2`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`2`) > 0.01)
name = str_split_fixed(temp2$mOTU, "\\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
b = temp2 %>% ggplot(aes(x=`2`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 2") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified"))+ ylab("") + theme(legend.position="none", text=element_text(size=12))
temp3 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`3`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`3`) > 0.01)
name = str_split_fixed(temp3$mOTU, "\\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
c = temp3 %>% ggplot(aes(x=`3`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 3") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
ggarrange(a,b,c, nrow=1)
ggarrange(a,b,c, nrow=1)
temp1 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`1`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`1`) > 0.01)
name = str_split_fixed(temp1$mOTU, "\\[ ", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
a = temp1 %>% ggplot(aes(x=`1`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 1") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
temp2 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`2`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`2`) > 0.01)
name = str_split_fixed(temp2$mOTU, "\\[ ", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
b = temp2 %>% ggplot(aes(x=`2`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 2") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified"))+ ylab("") + theme(legend.position="none", text=element_text(size=12))
temp3 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`3`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`3`) > 0.01)
name = str_split_fixed(temp3$mOTU, "\\[ ", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
c = temp3 %>% ggplot(aes(x=`3`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 3") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
ggarrange(a,b,c, nrow=1)
ggarrange(a,b,c, nrow=1)
temp1 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`1`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`1`) > 0.01)
name = str_split_fixed(temp1$mOTU, "\\[ ", 2)[,1]
name
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name
temp1 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`1`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`1`) > 0.01)
name = str_split_fixed(temp1$mOTU, "[ ", 2)[,1]
temp1 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`1`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`1`) > 0.01)
name = str_split_fixed(temp1$mOTU, "\\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name
temp1 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`1`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`1`) > 0.01)
name = str_split_fixed(temp1$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name
temp1 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`1`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`1`) > 0.01)
name = str_split_fixed(temp1$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
a = temp1 %>% ggplot(aes(x=`1`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 1") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
temp2 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`2`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`2`) > 0.01)
name = str_split_fixed(temp2$mOTU, " \\[ ", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
b = temp2 %>% ggplot(aes(x=`2`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 2") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified"))+ ylab("") + theme(legend.position="none", text=element_text(size=12))
temp3 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`3`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`3`) > 0.01)
name = str_split_fixed(temp3$mOTU, " \\[ ", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
c = temp3 %>% ggplot(aes(x=`3`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 3") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
ggarrange(a,b,c, nrow=1)
ggarrange(a,b,c, nrow=1)
temp1 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`1`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`1`) > 0.01)
name = str_split_fixed(temp1$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
name
a
b
c
temp1 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`1`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`1`) > 0.01)
name = str_split_fixed(temp1$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
a = temp1 %>% ggplot(aes(x=`1`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 1") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
temp2 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`2`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`2`) > 0.01)
name = str_split_fixed(temp2$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
b = temp2 %>% ggplot(aes(x=`2`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 2") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified"))+ ylab("") + theme(legend.position="none", text=element_text(size=12))
temp3 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`3`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`3`) > 0.01)
name = str_split_fixed(temp3$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
c = temp3 %>% ggplot(aes(x=`3`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 3") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
ggarrange(a,b,c, nrow=1)
ggarrange(a,b,c, nrow=1)
temp1 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`1`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`1`) > 0.00)
name = str_split_fixed(temp1$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
a = temp1 %>% ggplot(aes(x=`1`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 1") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
temp2 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`2`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`2`) > 0.00)
name = str_split_fixed(temp2$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
b = temp2 %>% ggplot(aes(x=`2`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 2") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified"))+ ylab("") + theme(legend.position="none", text=element_text(size=12))
temp3 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`3`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`3`) > 0.00)
name = str_split_fixed(temp3$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
c = temp3 %>% ggplot(aes(x=`3`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 3") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
ggarrange(a,b,c, nrow=1)
ggarrange(a,b,c, nrow=1)
a
b
c
sampleMeta = read.csv("./Data/Shao_sampleMetadata.csv", skip=2) %>% as_tibble()
subjectLoadings = cbind(finalModel$Fac[[1]], processedShao$mode1) %>% as_tibble() %>% left_join(sampleMeta) %>% select(-Time_point,-Accession,-WGS_reads_raw,-WGS_reads_trimmed) %>% filter(Infancy_sampling_age_months != "Mother") %>% unique()
transformedSubjectLoadings = transformPARAFACloadings(Fac, 2, moreOutput=TRUE)$Ftilde %>% as_tibble() %>% mutate(Individual = rep(processedShao$mode1$Individual, each=4), Time_point = rep(c(4,7,21,"Infancy"),1580/4)) %>% left_join(sampleMeta)
uncorrectedP = matrix(0L, nrow=3, ncol=7)
# Delivery mode
uncorrectedP[1,1] = wilcox.test(subjectLoadings %>% filter(Delivery_mode == "Caesarean") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Delivery_mode == "Vaginal") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,1] = wilcox.test(subjectLoadings %>% filter(Delivery_mode == "Caesarean") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Delivery_mode == "Vaginal") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,1] = wilcox.test(subjectLoadings %>% filter(Delivery_mode == "Caesarean") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Delivery_mode == "Vaginal") %>% select(`3`) %>% pull())$p.value
# Feeding method
uncorrectedP[1,2] = wilcox.test(subjectLoadings %>% filter(Feeding_method == "BF") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Feeding_method == "NoBF") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,2] = wilcox.test(subjectLoadings %>% filter(Feeding_method == "BF") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Feeding_method == "NoBF") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,2] = wilcox.test(subjectLoadings %>% filter(Feeding_method == "BF") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Feeding_method == "NoBF") %>% select(`3`) %>% pull())$p.value
# Gender
uncorrectedP[1,3] = wilcox.test(subjectLoadings %>% filter(Gender == "Male") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Gender == "Female") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,3] = wilcox.test(subjectLoadings %>% filter(Gender == "Male") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Gender == "Female") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,3] = wilcox.test(subjectLoadings %>% filter(Gender == "Male") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Gender == "Female") %>% select(`3`) %>% pull())$p.value
# Abx mother during labour
uncorrectedP[1,4] = wilcox.test(subjectLoadings %>% filter(Abx_mother_labour_IAP == "Yes") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Abx_mother_labour_IAP != "Yes") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,4] = wilcox.test(subjectLoadings %>% filter(Abx_mother_labour_IAP == "Yes") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Abx_mother_labour_IAP != "Yes") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,4] = wilcox.test(subjectLoadings %>% filter(Abx_mother_labour_IAP == "Yes") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Abx_mother_labour_IAP != "Yes") %>% select(`3`) %>% pull())$p.value
# Abx baby in hospital
uncorrectedP[1,5] = wilcox.test(subjectLoadings %>% filter(Abx_Baby_in_hospital  == "Yes") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Abx_Baby_in_hospital  != "Yes") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,5] = wilcox.test(subjectLoadings %>% filter(Abx_Baby_in_hospital  == "Yes") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Abx_Baby_in_hospital  != "Yes") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,5] = wilcox.test(subjectLoadings %>% filter(Abx_Baby_in_hospital  == "Yes") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Abx_Baby_in_hospital  != "Yes") %>% select(`3`) %>% pull())$p.value
# Abx baby after hospital
uncorrectedP[1,6] = wilcox.test(subjectLoadings %>% filter(Abx_Baby_after_hospital  == "Yes") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Abx_Baby_after_hospital  == "No") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,6] = wilcox.test(subjectLoadings %>% filter(Abx_Baby_after_hospital  == "Yes") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Abx_Baby_after_hospital  == "No") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,6] = wilcox.test(subjectLoadings %>% filter(Abx_Baby_after_hospital  == "Yes") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Abx_Baby_after_hospital  == "No") %>% select(`3`) %>% pull())$p.value
# Bacteroides profile
uncorrectedP[1,7] = wilcox.test(subjectLoadings %>% filter(Bacteroides_profile  == "low_Bacteroides") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Bacteroides_profile  == "normal_Bacteroides") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,7] = wilcox.test(subjectLoadings %>% filter(Bacteroides_profile  == "low_Bacteroides") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Bacteroides_profile  == "normal_Bacteroides") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,7] = wilcox.test(subjectLoadings %>% filter(Bacteroides_profile  == "low_Bacteroides") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Bacteroides_profile  == "normal_Bacteroides") %>% select(`3`) %>% pull())$p.value
correctedP = matrix(p.adjust(uncorrectedP, "BH"), nrow=3, ncol=7)
correctedP
# Plot 3B - make by hand to deal with colour feedback
# Set up colours
colours = RColorBrewer:: brewer.pal(8, "Dark2")
bm_cols = colours[1:2]
phylum_cols = colours[-c(1:2)]
# Flip Fac where needed
Fac = finalModel$Fac
Fac[[3]][,2] = -1 * Fac[[3]][,2]
Fac[[1]][,2] = -1 * Fac[[1]][,2]
Fac[[3]][,3] = -1 * Fac[[3]][,3]
Fac[[1]][,3] = -1 * Fac[[1]][,3]
days = c("4", "7", "21", "Infancy")
a = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 1") + theme(legend.position="none",text=element_text(size=12))
b = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
c = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V1)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
d = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 2") + theme(legend.position="none",text=element_text(size=12))
e = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
f = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V2)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
g = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("Subject index") + ylab("Component 3") + theme(legend.position="none",text=element_text(size=12))
h = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("Feature index") + ylab("") + theme(legend.position="none", text=element_text(size=12))
i = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V3)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="Time point [days]",limits=days)
ggarrange(a,b,c,d,e,f,g,h,i)
ggarrange(a,b,c,d,e,f,g,h,i)
cbind(Fac[[1]], processedShao$mode1) %>% as_tibble()
wilcox.test(subjectLoadings %>% filter(Feeding_method == "BF") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Feeding_method == "NoBF") %>% select(`1`) %>% pull())
wilcox.test(subjectLoadings %>% filter(Abx_mother_labour_IAP == "Yes") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Abx_mother_labour_IAP != "Yes") %>% select(`1`) %>% pull())
subjectLoadings %>% filter(Abx_mother_labour_IAP == "Yes") %>% select(`1`) %>% pull() %>% mean
subjectLoadings %>% filter(Abx_mother_labour_IAP != "Yes") %>% select(`1`) %>% pull() %>% mean
subjectLoadings %>% filter(Feeding_method == "BF") %>% select(`2`) %>% pull() %>% mean
subjectLoadings %>% filter(Feeding_method == "NoBF") %>% select(`2`) %>% pull() %>% mean
subjectLoadings %>% filter(Delivery_mode == "Caesarean-section") %>% select(`2`) %>% pull() %>% mean
subjectLoadings %>% filter(Delivery_mode == "Caesarean") %>% select(`2`) %>% pull() %>% mean
subjectLoadings %>% filter(Delivery_mode == "Vaginal") %>% select(`2`) %>% pull() %>% mean
# Plot 3B - make by hand to deal with colour feedback
# Set up colours
colours = RColorBrewer:: brewer.pal(8, "Dark2")
bm_cols = colours[1:2]
phylum_cols = colours[-c(1:2)]
# Flip Fac where needed
Fac = finalModel$Fac
Fac[[3]][,2] = -1 * Fac[[3]][,2]
Fac[[2]][,2] = -1 * Fac[[1]][,2]
# Plot 3B - make by hand to deal with colour feedback
# Set up colours
colours = RColorBrewer:: brewer.pal(8, "Dark2")
bm_cols = colours[1:2]
phylum_cols = colours[-c(1:2)]
# Flip Fac where needed
Fac = finalModel$Fac
Fac[[3]][,2] = -1 * Fac[[3]][,2]
Fac[[2]][,2] = -1 * Fac[[2]][,2]
Fac[[3]][,3] = -1 * Fac[[3]][,3]
Fac[[1]][,3] = -1 * Fac[[1]][,3]
days = c("4", "7", "21", "Infancy")
a = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 1") + theme(legend.position="none",text=element_text(size=12))
b = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
c = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V1)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
d = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 2") + theme(legend.position="none",text=element_text(size=12))
e = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
f = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V2)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
g = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("Subject index") + ylab("Component 3") + theme(legend.position="none",text=element_text(size=12))
h = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("Feature index") + ylab("") + theme(legend.position="none", text=element_text(size=12))
i = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V3)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="Time point [days]",limits=days)
ggarrange(a,b,c,d,e,f,g,h,i)
ggarrange(a,b,c,d,e,f,g,h,i)
temp1 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`1`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`1`) > 0.00)
name = str_split_fixed(temp1$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
a = temp1 %>% ggplot(aes(x=`1`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 1") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
temp2 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`2`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`2`) > 0.00)
name = str_split_fixed(temp2$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
b = temp2 %>% ggplot(aes(x=`2`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 2") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified"))+ ylab("") + theme(legend.position="none", text=element_text(size=12))
temp3 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`3`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`3`) > 0.00)
name = str_split_fixed(temp3$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
c = temp3 %>% ggplot(aes(x=`3`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 3") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
ggarrange(a,b,c, nrow=1)
ggarrange(a,b,c, nrow=1)
temp1 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`1`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`1`) > 0.01)
name = str_split_fixed(temp1$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
a = temp1 %>% ggplot(aes(x=`1`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 1") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
temp2 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`2`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`2`) > 0.01)
name = str_split_fixed(temp2$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
b = temp2 %>% ggplot(aes(x=`2`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 2") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified"))+ ylab("") + theme(legend.position="none", text=element_text(size=12))
temp3 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`3`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`3`) > 0.01)
name = str_split_fixed(temp3$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
c = temp3 %>% ggplot(aes(x=`3`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 3") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
ggarrange(a,b,c, nrow=1)
ggarrange(a,b,c, nrow=1)
subjectLoadings %>% filter(Feeding_method == "BF") %>% select(`2`) %>% pull() %>% mean
subjectLoadings %>% filter(Feeding_method == "NoBF") %>% select(`2`) %>% pull() %>% mean
subjectLoadings %>% filter(Delivery_mode == "Caesarean") %>% select(`2`) %>% pull() %>% mean
subjectLoadings %>% filter(Delivery_mode == "Vaginal") %>% select(`2`) %>% pull() %>% mean
# Plot 3B - make by hand to deal with colour feedback
# Set up colours
colours = RColorBrewer:: brewer.pal(8, "Dark2")
bm_cols = colours[1:2]
phylum_cols = colours[-c(1:2)]
# Flip Fac where needed
Fac = finalModel$Fac
Fac[[3]][,2] = -1 * Fac[[3]][,2]
Fac[[1]][,2] = -1 * Fac[[1]][,2]
Fac[[3]][,3] = -1 * Fac[[3]][,3]
Fac[[1]][,3] = -1 * Fac[[1]][,3]
days = c("4", "7", "21", "Infancy")
a = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 1") + theme(legend.position="none",text=element_text(size=12))
b = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
c = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V1)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
d = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 2") + theme(legend.position="none",text=element_text(size=12))
e = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
f = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V2)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
g = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("Subject index") + ylab("Component 3") + theme(legend.position="none",text=element_text(size=12))
h = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("Feature index") + ylab("") + theme(legend.position="none", text=element_text(size=12))
i = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V3)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="Time point [days]",limits=days)
ggarrange(a,b,c,d,e,f,g,h,i)
sampleMeta = read.csv("./Data/Shao_sampleMetadata.csv", skip=2) %>% as_tibble()
subjectLoadings = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% left_join(sampleMeta) %>% select(-Time_point,-Accession,-WGS_reads_raw,-WGS_reads_trimmed) %>% filter(Infancy_sampling_age_months != "Mother") %>% unique()
transformedSubjectLoadings = transformPARAFACloadings(Fac, 2, moreOutput=TRUE)$Ftilde %>% as_tibble() %>% mutate(Individual = rep(processedShao$mode1$Individual, each=4), Time_point = rep(c(4,7,21,"Infancy"),1580/4)) %>% left_join(sampleMeta)
uncorrectedP = matrix(0L, nrow=3, ncol=7)
# Delivery mode
uncorrectedP[1,1] = wilcox.test(subjectLoadings %>% filter(Delivery_mode == "Caesarean") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Delivery_mode == "Vaginal") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,1] = wilcox.test(subjectLoadings %>% filter(Delivery_mode == "Caesarean") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Delivery_mode == "Vaginal") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,1] = wilcox.test(subjectLoadings %>% filter(Delivery_mode == "Caesarean") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Delivery_mode == "Vaginal") %>% select(`3`) %>% pull())$p.value
# Feeding method
uncorrectedP[1,2] = wilcox.test(subjectLoadings %>% filter(Feeding_method == "BF") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Feeding_method == "NoBF") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,2] = wilcox.test(subjectLoadings %>% filter(Feeding_method == "BF") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Feeding_method == "NoBF") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,2] = wilcox.test(subjectLoadings %>% filter(Feeding_method == "BF") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Feeding_method == "NoBF") %>% select(`3`) %>% pull())$p.value
# Gender
uncorrectedP[1,3] = wilcox.test(subjectLoadings %>% filter(Gender == "Male") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Gender == "Female") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,3] = wilcox.test(subjectLoadings %>% filter(Gender == "Male") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Gender == "Female") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,3] = wilcox.test(subjectLoadings %>% filter(Gender == "Male") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Gender == "Female") %>% select(`3`) %>% pull())$p.value
# Abx mother during labour
uncorrectedP[1,4] = wilcox.test(subjectLoadings %>% filter(Abx_mother_labour_IAP == "Yes") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Abx_mother_labour_IAP != "Yes") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,4] = wilcox.test(subjectLoadings %>% filter(Abx_mother_labour_IAP == "Yes") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Abx_mother_labour_IAP != "Yes") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,4] = wilcox.test(subjectLoadings %>% filter(Abx_mother_labour_IAP == "Yes") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Abx_mother_labour_IAP != "Yes") %>% select(`3`) %>% pull())$p.value
# Abx baby in hospital
uncorrectedP[1,5] = wilcox.test(subjectLoadings %>% filter(Abx_Baby_in_hospital  == "Yes") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Abx_Baby_in_hospital  != "Yes") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,5] = wilcox.test(subjectLoadings %>% filter(Abx_Baby_in_hospital  == "Yes") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Abx_Baby_in_hospital  != "Yes") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,5] = wilcox.test(subjectLoadings %>% filter(Abx_Baby_in_hospital  == "Yes") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Abx_Baby_in_hospital  != "Yes") %>% select(`3`) %>% pull())$p.value
# Abx baby after hospital
uncorrectedP[1,6] = wilcox.test(subjectLoadings %>% filter(Abx_Baby_after_hospital  == "Yes") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Abx_Baby_after_hospital  == "No") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,6] = wilcox.test(subjectLoadings %>% filter(Abx_Baby_after_hospital  == "Yes") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Abx_Baby_after_hospital  == "No") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,6] = wilcox.test(subjectLoadings %>% filter(Abx_Baby_after_hospital  == "Yes") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Abx_Baby_after_hospital  == "No") %>% select(`3`) %>% pull())$p.value
# Bacteroides profile
uncorrectedP[1,7] = wilcox.test(subjectLoadings %>% filter(Bacteroides_profile  == "low_Bacteroides") %>% select(`1`) %>% pull(),
subjectLoadings %>% filter(Bacteroides_profile  == "normal_Bacteroides") %>% select(`1`) %>% pull())$p.value
uncorrectedP[2,7] = wilcox.test(subjectLoadings %>% filter(Bacteroides_profile  == "low_Bacteroides") %>% select(`2`) %>% pull(),
subjectLoadings %>% filter(Bacteroides_profile  == "normal_Bacteroides") %>% select(`2`) %>% pull())$p.value
uncorrectedP[3,7] = wilcox.test(subjectLoadings %>% filter(Bacteroides_profile  == "low_Bacteroides") %>% select(`3`) %>% pull(),
subjectLoadings %>% filter(Bacteroides_profile  == "normal_Bacteroides") %>% select(`3`) %>% pull())$p.value
correctedP = matrix(p.adjust(uncorrectedP, "BH"), nrow=3, ncol=7)
correctedP
subjectLoadings %>% filter(Delivery_mode == "Caesarean") %>% select(`1`) %>% pull() %>% mean
subjectLoadings %>% filter(Delivery_mode == "Vaginal") %>% select(`1`) %>% pull() %>% mean
subjectLoadings %>% filter(Delivery_mode == "Vaginal") %>% select(`2`) %>% pull() %>% mean
subjectLoadings %>% filter(Delivery_mode == "Caesarean") %>% select(`2`) %>% pull() %>% mean
subjectLoadings %>% filter(Delivery_mode == "Caesarean") %>% select(`3`) %>% pull() %>% mean
subjectLoadings %>% filter(Delivery_mode == "Vaginal") %>% select(`3`) %>% pull() %>% mean
subjectLoadings %>% filter(Abx_mother_labour_IAP == "Yes") %>% select(`1`) %>% pull()
subjectLoadings %>% filter(Abx_mother_labour_IAP == "Yes") %>% select(`1`) %>% pull() %>% mean
subjectLoadings %>% filter(Abx_mother_labour_IAP != "Yes") %>% select(`1`) %>% pull() %>% mean
subjectLoadings %>% filter(Feeding_method == "BF") %>% select(`2`) %>% pull() %>% mean()
subjectLoadings %>% filter(Feeding_method == "NoBF") %>% select(`2`) %>% pull() %>% mean()
temp1 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`1`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`1`) > 0.01)
name = str_split_fixed(temp1$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
a = temp1 %>% ggplot(aes(x=`1`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 1") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
temp2 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`2`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`2`) > 0.01)
name = str_split_fixed(temp2$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
b = temp2 %>% ggplot(aes(x=`2`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 2") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified"))+ ylab("") + theme(legend.position="none", text=element_text(size=12))
temp3 = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(`3`) %>% mutate(index=1:nrow(.)) %>% filter(abs(`3`) > 0.01)
name = str_split_fixed(temp3$mOTU, " \\[", 2)[,1]
name = str_split_fixed(name, " ", 3)[,2:3] %>% as_tibble()
name[name$V1 == "","V1"] = "Unclassified"
name = paste0(name$V1, " ", name$V2)
c = temp3 %>% ggplot(aes(x=`3`,y=as.factor(index),fill=as.factor(phylum))) + geom_bar(stat="identity") + ylab("Microbiota") + xlab("Component 3") + scale_y_discrete(labels=name) + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + ylab("") + theme(legend.position="none", text=element_text(size=12))
ggarrange(a,b,c, nrow=1)
ggarrange(a,b,c, nrow=1)
# Plot 3B - make by hand to deal with colour feedback
# Set up colours
colours = RColorBrewer:: brewer.pal(8, "Dark2")
bm_cols = colours[1:2]
phylum_cols = colours[-c(1:2)]
# Flip Fac where needed
Fac = finalModel$Fac
Fac[[3]][,2] = -1 * Fac[[3]][,2]
Fac[[1]][,2] = -1 * Fac[[1]][,2]
Fac[[3]][,3] = -1 * Fac[[3]][,3]
Fac[[1]][,3] = -1 * Fac[[1]][,3]
days = c("4", "7", "21", "Infancy")
a = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 1") + theme(legend.position="none",text=element_text(size=12))
b = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`1`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
c = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V1)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
d = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("") + ylab("Component 2") + theme(legend.position="none",text=element_text(size=12))
e = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`2`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("") + ylab("") + theme(legend.position="none", text=element_text(size=12))
f = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V2)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="",limits=days)
g = cbind(Fac[[1]], processedShao$mode1) %>% as_tibble() %>% arrange(Delivery_mode, Individual) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(Delivery_mode))) + geom_bar(stat="identity") + scale_fill_manual(name="Birth mode", values=bm_cols, labels=c("Caesarean", "Vaginal")) + xlab("Subject index") + ylab("Component 3") + theme(legend.position="none",text=element_text(size=12))
h = cbind(Fac[[2]], processedShao$mode2) %>% as_tibble() %>% arrange(phylum, class, order, family, genus, mOTU, OTU) %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=`3`,fill=as.factor(phylum))) + geom_bar(stat="identity") + scale_fill_manual(name="Phylum", values=phylum_cols, labels=c("Actinobacteria", "Bacteroidetes", "Firmicutes", "Proteobacteria", "Unclassified")) + xlab("Feature index") + ylab("") + theme(legend.position="none", text=element_text(size=12))
i = Fac[[3]] %>% as_tibble() %>% mutate(index=1:nrow(.)) %>% ggplot(aes(x=index,y=V3)) + geom_line() + geom_point() + xlab("") + ylab("") + scale_x_discrete(name="Time point [days]",limits=days)
ggarrange(a,b,c,d,e,f,g,h,i)
ggarrange(a,b,c,d,e,f,g,h,i)
