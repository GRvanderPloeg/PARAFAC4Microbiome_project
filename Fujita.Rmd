---
title: "Fujita"
output: html_document
date: "2024-03-10"
---

```{r setup}
library(parafac4microbiome)
```

```{r prep plot data}
# Plot settings
colourCols = c("", "Genus", "")
legendTitles = c("", "Genus", "")
xLabels = c("Replicate", "Feature index", "Time point")
legendColNums = c(0,5,0)
arrangeModes = c(FALSE, TRUE, FALSE)
continuousModes = c(FALSE,FALSE,TRUE)
```

```{r process the data}
processedFujita = processDataCube(Fujita2023, sparsityThreshold=1, centerMode=1, scaleMode=2)
```

```{r investigate num comp}
assessment = assessNumComponents(processedFujita$data)
```

```{r check the plots}
assessment$plots$overview
# 4 or 3 components seems okay
```

```{r model stability}
numFolds = 8

stability3 = modelStabilityCheck(processedFujita, numComponents=3, numFolds=numFolds, colourCols=colourCols, legendTitles=legendTitles, xLabels=xLabels, legendColNums=legendColNums, arrangeModes=arrangeModes, continuousModes=continuousModes)
stability4 = modelStabilityCheck(processedFujita, numComponents=4, numFolds=numFolds, colourCols=colourCols, legendTitles=legendTitles, xLabels=xLabels, legendColNums=legendColNums, arrangeModes=arrangeModes, continuousModes=continuousModes)

stability3$plot
stability4$plot
# So we choose 3 components
```